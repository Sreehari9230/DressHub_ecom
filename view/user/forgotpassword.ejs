<script>
    console.log(email)
    document.addEventListener('DOMContentLoaded', function() {
        const otpForm = document.getElementById('otpForm');
        const errorMessageElement = document.getElementById('errorMessage');
        
        // Add event listener to the form submission
        otpForm.addEventListener('submit', async function(event) {
            event.preventDefault(); // Prevent default form submission behavior
            console.log('kkk');
            // Collect form data
            const formData = new FormData(otpForm);
            
            // Create an object to hold the form data
            const formObject = {};
            formData.forEach(function(value, key){
                formObject[key] = value;
            });
            console.log(formObject);
            
            try {
                // Make a fetch request
                const response = await fetch(`/verifyotp?email=${email}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formObject) // Convert the form object to JSON string
                });
                
                const data = await response.json(); // Parse response body as JSON
                
                if (response.ok) {
                    // Handle successful response, maybe redirect or show a success message
                    console.log('OTP verification successful');
                    window.location.href = '/';
                } else {
                    // Handle error response
                    console.error('Failed to verify OTP');
                    if (data.message) {
                        // Display error message within the form
                        errorMessageElement.textContent = data.message;
                    }
                    
                    // Highlight the invalid OTP input fields (if needed)
                    const otpInputs = document.querySelectorAll('.otp-input');
                    otpInputs.forEach(input => {
                        input.style.borderColor = 'red';
                    });
                }
            } catch (error) {
                console.error('Error occurred during OTP verification:', error);
            }
        });
    });
    
    
    
    document.addEventListener('DOMContentLoaded', function() {
        const resendButton = document.getElementById('resendLink');
        const successMessageElement = document.getElementById('successMessage');
        
        // Add event listener to the resend button
        resendButton.addEventListener('click', async function(event) {
            // Prevent default button behavior
            event.preventDefault();
            
            // Get the email value from the hidden input field
            const email = document.getElementById('emailInput').value;
    
            // Make a fetch request to resend OTP
            try {
                const response = await fetch('/resend-otp', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email: email }) // Include email in the request body
                });
    
                if (response.ok) {
                    // Display success message within the form
                    successMessageElement.textContent = 'OTP resent successfully';
                } else {
                    // Handle error response
                    console.error('Failed to resend OTP');
                }
            } catch (error) {
                console.error('Error occurred while resending OTP:', error);
            }
        });
    });
    
    </script>